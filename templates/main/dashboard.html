{% extends 'main/base.html' %}
{% load static %}

{% block title %}Dashboard - MentalMate{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <!-- Animated Hero Section -->
    <div class="hero-section position-relative mb-5 overflow-hidden">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <div class="row align-items-center">
                <div class="col-lg-6 hero-text pe-lg-5">
                    <h1 class="display-4 fw-bold text-gradient mb-3 animate__animated animate__fadeInUp">
                        Your Personal AI Companion for Mental Wellness
                    </h1>
                    <p class="lead mb-4 text-muted animate__animated animate__fadeInUp animate__delay-1s">
                        Experience personalized mental health support with AI-powered companions, mood tracking, and insightful analytics.
                    </p>
                    <div class="d-flex gap-3 animate__animated animate__fadeInUp animate__delay-2s">
                        <a href="{% url 'chatbot-create' %}" class="btn btn-primary btn-lg rounded-pill">
                            <i class="bi bi-plus-circle me-2"></i> Create AI Companion
                        </a>
                        <a href="{% url 'track-wellness' %}" class="btn btn-outline-primary btn-lg rounded-pill">
                            <i class="bi bi-heart me-2"></i> Track Wellness
                        </a>
                    </div>
                    <div class="hero-stats mt-5 animate__animated animate__fadeInUp animate__delay-3s">
                        <div class="row g-4">
                            <div class="col-auto">
                                <div class="stat-box">
                                    <div class="stat-value">{{ chatbots.count }}</div>
                                    <div class="stat-label">AI Companions</div>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="stat-box">
                                    <div class="stat-value">{{ wellness_score }}%</div>
                                    <div class="stat-label">Wellness Score</div>
                                </div>
                            </div>
                            <div class="col-auto">
                                <div class="stat-box">
                                    <div class="stat-value">15</div>
                                    <div class="stat-label">Day Streak</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 hero-image text-center animate__animated animate__fadeInRight">
                    <div class="floating-elements">
                        <div class="floating-circle circle-1"></div>
                        <div class="floating-circle circle-2"></div>
                        <div class="floating-circle circle-3"></div>
                        <img src="https://img.freepik.com/free-vector/mental-health-awareness-concept_23-2148514643.jpg" 
                             alt="Mental Health Illustration" 
                             class="img-fluid main-image">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inspirational Quote Card -->
    <div class="card border-0 shadow-lg rounded-4 mb-4 overflow-hidden quote-card">
        <div class="card-body p-4">
            <div class="quote-content text-center animate__animated animate__fadeIn">
                <i class="bi bi-quote display-4 text-primary opacity-25"></i>
                <blockquote class="mb-3" id="quoteText">
                    "There is hope, even when your brain tells you there isn't."
                </blockquote>
                <footer class="blockquote-footer" id="quoteAuthor">
                    — John Green
                </footer>
            </div>
            <button class="btn btn-link text-primary p-0 position-absolute top-0 end-0 m-3" id="refreshQuote">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
        </div>
    </div>

    <!-- Rest of the dashboard content -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-lg rounded-4 h-100">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle p-3 me-3" style="background: rgba(37, 99, 235, 0.1)">
                            <i class="bi bi-heart-pulse text-primary" style="font-size: 1.5rem;"></i>
                        </div>
                        <div>
                            <h3 class="mb-0 fw-bold">{{ wellness_score }}%</h3>
                            <p class="text-muted mb-0">Wellness Score</p>
                        </div>
                    </div>
                    <a href="{% url 'track-wellness' %}" class="btn btn-primary btn-sm rounded-pill w-100">
                        <i class="bi bi-plus-circle"></i> Track Today
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-lg rounded-4 h-100">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle p-3 me-3" style="background: rgba(16, 185, 129, 0.1)">
                            <i class="bi bi-robot text-success" style="font-size: 1.5rem;"></i>
                        </div>
                        <div>
                            <h3 class="mb-0 fw-bold">{{ chatbots.count }}</h3>
                            <p class="text-muted mb-0">AI Companions</p>
                        </div>
                    </div>
                    <a href="{% url 'chatbot-create' %}" class="btn btn-success btn-sm rounded-pill w-100">
                        <i class="bi bi-plus-circle"></i> Create Bot
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-lg rounded-4 h-100">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle p-3 me-3" style="background: rgba(245, 158, 11, 0.1)">
                            <i class="bi bi-journal-text text-warning" style="font-size: 1.5rem;"></i>
                        </div>
                        <div>
                            <h3 class="mb-0 fw-bold">{{ blog_posts.count }}</h3>
                            <p class="text-muted mb-0">Blog Posts</p>
                        </div>
                    </div>
                    <a href="{% url 'blog-create' %}" class="btn btn-warning btn-sm rounded-pill w-100">
                        <i class="bi bi-plus-circle"></i> Write Post
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-lg rounded-4 h-100">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-3">
                        <div class="rounded-circle p-3 me-3" style="background: rgba(239, 68, 68, 0.1)">
                            <i class="bi bi-calendar-check text-danger" style="font-size: 1.5rem;"></i>
                        </div>
                        <div>
                            <h3 class="mb-0 fw-bold">15</h3>
                            <p class="text-muted mb-0">Day Streak</p>
                        </div>
                    </div>
                    <button class="btn btn-danger btn-sm rounded-pill w-100">
                        <i class="bi bi-fire"></i> Keep it Up!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Wellness Chart -->
    <div class="card border-0 shadow-lg rounded-4 mb-4">
        <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="card-title mb-0">Wellness Trends</h4>
                <a href="{% url 'track-wellness' %}" class="btn btn-primary btn-sm rounded-pill px-3">
                    <i class="bi bi-plus-circle"></i> New Entry
                </a>
            </div>
            <canvas id="wellnessChart" height="100"></canvas>
        </div>
    </div>

    <!-- Chatbots and Latest Posts -->
    <div class="row g-4">
        <!-- My Chatbots -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="card-title mb-0">My AI Companions</h4>
                        <a href="{% url 'chatbot-create' %}" class="btn btn-primary btn-sm rounded-pill px-3">
                            <i class="bi bi-plus-circle"></i> New Bot
                        </a>
                    </div>
                    
                    {% if chatbots %}
                    <div class="row g-3">
                        {% for chatbot in chatbots %}
                        <div class="col-md-6">
                            <div class="card h-100 border-0 shadow-sm rounded-4 position-relative overflow-hidden">
                                <!-- Gradient background -->
                                <div class="position-absolute w-100 h-100" style="background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%); opacity: 0.7;"></div>
                                
                                <div class="card-body position-relative p-4">
                                    <div class="d-flex align-items-center mb-3">
                                        {% if chatbot.avatar %}
                                            <img src="{{ chatbot.avatar.url }}" alt="{{ chatbot.name }}" class="rounded-circle me-3"
                                                 style="width: 48px; height: 48px; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                        {% else %}
                                            <img src="{% static 'main/avatars/default.png' %}" alt="{{ chatbot.name }}" class="rounded-circle me-3"
                                                 style="width: 48px; height: 48px; object-fit: cover; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                        {% endif %}
                                        <div>
                                            <h5 class="mb-1">{{ chatbot.name }}</h5>
                                            <span class="badge bg-primary-subtle text-primary">{{ chatbot.get_personality_display }}</span>
                                        </div>
                                    </div>
                                    <p class="text-muted mb-3">{{ chatbot.specific_concerns|truncatechars:100 }}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <a href="{% url 'chatbot-chat' chatbot.pk %}" class="btn btn-primary rounded-pill px-4">
                                            <i class="bi bi-chat-dots"></i> Chat Now
                                        </a>
                                        <div class="dropdown">
                                            <button class="btn btn-light rounded-circle" type="button" data-bs-toggle="dropdown">
                                                <i class="bi bi-three-dots-vertical"></i>
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li><a class="dropdown-item" href="{% url 'chatbot-update' chatbot.pk %}">
                                                    <i class="bi bi-pencil me-2"></i> Edit
                                                </a></li>
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-danger" href="{% url 'chatbot-delete' chatbot.pk %}">
                                                    <i class="bi bi-trash me-2"></i> Delete
                                                </a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <img src="https://img.freepik.com/free-vector/chatbot-artificial-intelligence-abstract-concept-illustration_335657-3723.jpg"
                             alt="No Chatbots"
                             style="width: 200px; height: 200px; object-fit: contain;">
                        <h5 class="mt-4">No AI Companions Yet</h5>
                        <p class="text-muted">Create your first chatbot to get started!</p>
                        <a href="{% url 'chatbot-create' %}" class="btn btn-primary rounded-pill px-4">
                            <i class="bi bi-plus-circle"></i> Create Bot
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Latest Blog Posts -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="card-title mb-0">Latest Posts</h4>
                        <a href="{% url 'blog-create' %}" class="btn btn-primary btn-sm rounded-pill px-3">
                            <i class="bi bi-plus-circle"></i> New Post
                        </a>
                    </div>
                    
                    {% if blog_posts %}
                    <div class="d-flex flex-column gap-3">
                        {% for post in blog_posts %}
                        <a href="{% url 'blog-detail' post.pk %}" class="card border-0 shadow-sm rounded-4 text-decoration-none">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-primary-subtle text-primary me-2">{{ post.get_category_display }}</span>
                                    <small class="text-muted">{{ post.created_at|date:"M d, Y" }}</small>
                                </div>
                                <h6 class="card-title text-primary mb-2">{{ post.title }}</h6>
                                <p class="card-text text-muted small mb-0">{{ post.content|truncatechars:100 }}</p>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-journal-text display-4 text-muted"></i>
                        <h5 class="mt-3">No Blog Posts</h5>
                        <p class="text-muted">Share your thoughts and experiences!</p>
                        <a href="{% url 'blog-create' %}" class="btn btn-primary rounded-pill px-4">
                            <i class="bi bi-plus-circle"></i> Create Post
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('wellnessChart').getContext('2d');
    fetch('{% url "wellness-data" %}')
        .then(response => response.json())
        .then(data => {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.dates,
                    datasets: [{
                        label: 'Mood',
                        data: data.moods,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Energy',
                        data: data.energy_levels,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Anxiety',
                        data: data.anxiety_levels,
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        });

    // Rotating Quotes
    const quotes = [
        {
            text: "There is hope, even when your brain tells you there isn't.",
            author: "John Green"
        },
        {
            text: "You don't have to control your thoughts. You just have to stop letting them control you.",
            author: "Dan Millman"
        },
        {
            text: "Self-care is how you take your power back.",
            author: "Lalah Delia"
        },
        {
            text: "You, yourself, as much as anybody in the entire universe, deserve your love and affection.",
            author: "Buddha"
        },
        {
            text: "Your present circumstances don't determine where you can go; they merely determine where you start.",
            author: "Nido Qubein"
        },
        {
            text: "Mental health…is not a destination, but a process. It's about how you drive, not where you're going.",
            author: "Noam Shpancer"
        }
    ];
    let currentQuote = 0;
    let quoteInterval;
    const quoteText = document.getElementById('quoteText');
    const quoteAuthor = document.getElementById('quoteAuthor');
    const refreshQuoteBtn = document.getElementById('refreshQuote');

    function showQuote(index) {
        quoteText.innerHTML = `"${quotes[index].text}"`;
        quoteAuthor.innerHTML = `— ${quotes[index].author}`;
        // Add animation
        quoteText.classList.remove('animate__fadeIn');
        void quoteText.offsetWidth;
        quoteText.classList.add('animate__fadeIn');
    }

    function nextQuote() {
        currentQuote = (currentQuote + 1) % quotes.length;
        showQuote(currentQuote);
    }

    function startQuoteRotation() {
        if (quoteInterval) clearInterval(quoteInterval);
        quoteInterval = setInterval(nextQuote, 5000);
    }

    // Initial quote
    showQuote(currentQuote);
    startQuoteRotation();

    // Refresh quote on button click
    refreshQuoteBtn.addEventListener('click', function() {
        nextQuote();
        startQuoteRotation();
        this.classList.add('rotate-animation');
        setTimeout(() => this.classList.remove('rotate-animation'), 500);
    });
});
</script>

<style>
/* Hero Section Styles */
.hero-section {
    min-height: 600px;
    padding: 4rem 0;
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(147, 197, 253, 0.1) 100%);
    border-radius: 2rem;
    position: relative;
}

.hero-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="2" cy="2" r="2" fill="%232563eb" fill-opacity="0.1"/></svg>');
    opacity: 0.5;
    z-index: 0;
}

.hero-content {
    position: relative;
    z-index: 1;
    padding: 2rem;
}

.text-gradient {
    background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.hero-text {
    position: relative;
    z-index: 2;
}

.floating-elements {
    position: relative;
    perspective: 1000px;
}

.main-image {
    max-width: 80%;
    filter: drop-shadow(0 20px 30px rgba(0, 0, 0, 0.1));
    animation: float 6s ease-in-out infinite;
}

.floating-circle {
    position: absolute;
    border-radius: 50%;
    opacity: 0.1;
    background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
}

.circle-1 {
    width: 100px;
    height: 100px;
    top: -20px;
    left: 10%;
    animation: float 8s ease-in-out infinite;
}

.circle-2 {
    width: 150px;
    height: 150px;
    bottom: 10%;
    right: 5%;
    animation: float 10s ease-in-out infinite;
}

.circle-3 {
    width: 70px;
    height: 70px;
    top: 40%;
    left: 5%;
    animation: float 7s ease-in-out infinite;
}

.stat-box {
    background: rgba(255, 255, 255, 0.9);
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
    text-align: center;
    min-width: 120px;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2563eb;
    margin-bottom: 0.25rem;
}

.stat-label {
    font-size: 0.875rem;
    color: #6b7280;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
}

/* Adding animate.css classes */
.animate__animated {
    animation-duration: 1s;
}

.animate__delay-1s {
    animation-delay: 0.2s;
}

.animate__delay-2s {
    animation-delay: 0.4s;
}

.animate__delay-3s {
    animation-delay: 0.6s;
}

/* Rest of the existing styles */
.card {
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.bg-primary-subtle {
    background-color: rgba(37, 99, 235, 0.1) !important;
}

.text-primary {
    color: #2563eb !important;
}

.btn-primary {
    background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
    border: none;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
}

.btn-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
}

.btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    border: none;
}

.btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    border: none;
}

/* Quote Card Styles */
.quote-card {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    transition: transform 0.2s;
}

.quote-card:hover {
    transform: translateY(-2px);
}

.quote-content blockquote {
    font-size: 1.25rem;
    font-weight: 500;
    color: #1e293b;
    font-style: italic;
}

.blockquote-footer {
    color: #64748b;
}

#refreshQuote {
    opacity: 0.5;
    transition: opacity 0.2s, transform 0.2s;
}

#refreshQuote:hover {
    opacity: 1;
}

.rotate-animation {
    animation: rotate 0.5s linear;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
 }
</style>
{% endblock %}
{% endblock %}